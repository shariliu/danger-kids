---
title: "CLIF Adult Data Analysis"
author: "Nensi Gjata and Shari Liu"
date: "2/7/2021"
output:
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: console
---

# Load, Import, and Organize Data

```{r load, message=FALSE}
library(tidyverse)
library(dplyr)
library(lme4)
library(lmerTest)
library(reghelper)
library(ggplot2)
library(cowplot)
library(boot)
library(simr)
library(MuMIn)
library(gmodels)
library(corrplot)

knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

```

```{r cleanup, echo=FALSE, eval=FALSE}
# raw_data <- read.csv(file="Raw_Adult_Dataset.csv")
# 
# clean <- raw_data %>%
#   slice(-1:-2)  %>% # delete first and second rows with question information
#   subset(WorkerID != "") %>% # delete all non-MTURK responses
#   mutate(Duration = as.numeric(as.character(Duration..in.seconds.)), CC6 = as.character(CC6), AC=as.character(AC)) %>% # convert exclusion measures to characters or numbers
#   filter(grepl("cliff|object|like|dislike|jump|want|action|judge|deep|shallow|rate|small|big|answer|figure", CC6)) %>% # filter out participants who did not include at least 1 keyword in their responses
#   mutate(AC_check = mapply(adist, "Wendi's favorite gelato flavor is sea salt caramel", AC)) %>%  # create column for mistakes in attention check
#   filter(Duration >= 240, AC_check <= 5) %>%  # factor out participants who spent less than four minutes, greater than five mistakes in attention check
#   mutate(ID = row_number()) %>% # deidentify participants
#   select(ID, everything())
# 
# write.csv(clean, "CLIF-Adult-Dataset.csv") # export deidentified dataset
```

```{r import.data}
# import deidentified dataset
data <- read.csv(file="CLIF-Adult-Dataset.csv") %>% 
  mutate(ID=as.factor(ID))
```









# Task 1

## Task 1: Tidy Data
```{r exp1, echo=FALSE}
# gather DVs separately
exp1_jump <- data %>%
  select(ID, Version, contains("Jump")) %>%  # select Task 1 trials, ID, and Version
  gather(orig, DV_Subj_Jump, contains("Jump")) %>% # split trials into rows
  separate(orig, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% # separate original name
  mutate(DV_Subj_Jump = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Jump),  as.numeric(DV_Subj_Jump)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>%  # find depth and adjust responses for counterbalancing across Versions
  arrange(ID) # arrange by ID number
  
exp1_fall <- data %>%
  select(ID, Version, contains("Fall")) %>%
  gather(orig2, DV_Subj_Fall, contains("Fall")) %>% 
  separate(orig2, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
  mutate(DV_Subj_Fall = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Fall), as.numeric(DV_Subj_Fall)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>% 
  arrange(ID) # arrange by ID number

# find baseline values for jump
baseline_jump <- exp1_jump %>%
  select(ID, IV_Objective, DV_Subj_Jump) %>%
  filter(IV_Objective == "4") %>% # filter by responses to medium cliff (baseline measure)
  mutate(count = 7) %>% # produce baseline depth for all responses in A and B (even NAs)
  uncount(count) %>%
  rename(DV_Subj_Jump_Baseline = DV_Subj_Jump) %>% 
  select(DV_Subj_Jump_Baseline)

# find baseline values for fall
baseline_fall <- exp1_fall %>%
  select(ID, IV_Objective, DV_Subj_Fall) %>% 
  filter(IV_Objective == "4") %>% 
  mutate(count = 7) %>%
  uncount(count) %>% 
  rename(DV_Subj_Fall_Baseline = DV_Subj_Fall) %>% 
  select(DV_Subj_Fall_Baseline)

# compile final jump data
exp1_jump <- cbind(exp1_jump, baseline_jump) %>% 
  mutate(DV_Subj_Jump_Diff = DV_Subj_Jump - DV_Subj_Jump_Baseline) 

# compile final fall data
exp1_fall <- cbind(exp1_fall, baseline_fall) %>% 
  mutate(DV_Subj_Fall_Diff = DV_Subj_Fall - DV_Subj_Fall_Baseline) 

# compile combined dataset (including incomplete trials)
exp1_full <- merge(exp1_fall, exp1_jump) 
```

## Task 1: Plots
```{r exp1.plot.jump, echo=FALSE, eval=FALSE}
# produce Task 1 jump plot
(exp1.jump.plot.adult <- exp1_jump %>% 
  ggplot(aes(x = IV_Objective, y = DV_Subj_Jump)) +
  scale_x_continuous(breaks=seq(1,7,1)) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.1, size=.8) +
  geom_boxplot(aes(group=IV_Objective), color="#333333", width=.5, fill=NA, size=1) +
  geom_point(color="#5F8DAE", size=3) +
  stat_summary(fun.data = "mean_cl_boot", geom="errorbar", color="#003e67", width=0.15, size=1.5) +
  stat_summary(fun="mean", geom="point", shape=23, size=6, fill="white", color="#003e67", stroke=3) +
  theme_bw() +
  theme(axis.text=element_text(size=35)) +
  ylim(0, 100) +
  labs(x = "", y = ""))

ggsave(filename="task1.jump.adult.plot.png", path="/Users/Nensi/Desktop", width = 40, height = 12, units = "cm", dpi=300)
```

```{r exp1.plot.fall, echo=FALSE, eval=FALSE}
# produce Task 1 fall plot
(exp1.fall.plot.adult <- exp1_fall %>%
  ggplot(aes(x = IV_Objective, y = DV_Subj_Fall)) +
  scale_x_continuous(breaks=seq(1,7,1)) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.1, size=.8) +
  geom_boxplot(aes(group=IV_Objective), color="#333333", width=.5, fill=NA, size=1) +
  geom_point(color="#5F8DAE", size=3) +
  stat_summary(fun.data="mean_cl_boot", geom="errorbar", color="#003e67", width=0.15, size=1.5) +
  stat_summary(fun="mean", geom="point", shape=23, size=6, fill="white", color="#003e67", stroke=3) +
  theme_bw() +
  theme(axis.text=element_text(size=35)) +
  ylim(0, 100) +
  labs(x = "", y = ""))

ggsave(filename="task1.fall.adult.plot.png", path="/Users/Nensi/Desktop", width = 40, height = 12, units = "cm", dpi=300)
```

```{r exp1.plot.jump.indv, echo=FALSE, eval=FALSE}
# produce Task 1 jump plot (individual graph per participant)
(exp1.jump.plot.indv.adult <- exp1_jump %>% 
  ggplot(aes(x = IV_Objective, y = DV_Subj_Jump)) +
  scale_x_continuous(breaks=seq(1,7,1)) +
  facet_wrap(vars(ID), ncol = 6) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.2, size=1.5) +
  geom_point(color="#5F8DAE", size=3) +
  theme_bw() +
  theme(axis.text=element_text(size=13)) +
  ylim(0, 100) +
  labs(x = "", y = ""))

ggsave(filename="task1.jump.adult.indv.png", path="/Users/Nensi/Desktop", width = 36, height = 30, units = "cm", dpi=300)
```

```{r exp1.plot.fall.indv, echo=FALSE, eval=FALSE}
# produce Task 1 fall plot (individual graph per participant)
(exp1.fall.plot.indv.adult <- exp1_fall %>% 
  ggplot(aes(x = IV_Objective, y = DV_Subj_Fall)) +
  scale_x_continuous(breaks=seq(1,7,1)) +
  facet_wrap(vars(ID), ncol = 6) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.2, size=1.5) +
  geom_point(color="#5F8DAE", size=3) +
  theme_bw() +
  theme(axis.text=element_text(size=13)) +
  ylim(0, 100) +
  labs(x = "", y = ""))

ggsave(filename="task1.fall.adult.indv.png", path="/Users/Nensi/Desktop", width = 36, height = 30, units = "cm", dpi=300)
```

## Task 1: Main Analyses
### Main Analysis (Jump)
```{r exp1.jump.analysis}
# null model jump (converges, no error message)
null1.jump.adult <- lmer(data = exp1_jump, formula = DV_Subj_Jump ~ 1 + (1+IV_Objective|ID))

# hypothesis-driven model jump (converges, no error message)
model1.jump.adult <- lmer(data = exp1_jump, formula = DV_Subj_Jump ~ IV_Objective + (1+IV_Objective|ID))

# standardized model jump (converges, no error message)
model1.jump.standard.adult <- lmer(data = exp1_jump, formula = scale(DV_Subj_Jump) ~ scale(IV_Objective) + (1+scale(IV_Objective)|ID))

# task 1 jump summaries
confint(model1.jump.adult)
summary(model1.jump.adult)
summary(model1.jump.standard.adult)

# likelihood ratio test for comparing models (jump)
anova(null1.jump.adult, model1.jump.adult)

# r-squared For generalized mixed-effect models
r.squaredGLMM(null1.jump.adult)
r.squaredGLMM(model1.jump.adult) # adding predictors adds 22.46% variance explained 
```

### Main Analysis (Fall)
```{r exp1.fall.analysis}
#null model fall (converges, no error message)
null1.fall.adult <- lmer(data = exp1_fall, formula = DV_Subj_Fall ~ 1 + (1+IV_Objective|ID))

#null model fall, simple (converges, no error message)
null1.fall.simple.adult <- lmer(data = exp1_fall, formula = DV_Subj_Fall ~ 1 + (1|ID))

# hypothesis-driven model fall (failed to converge) 
#model1.fall.adult <- lmer(data = exp1_fall, formula = DV_Subj_Fall ~ IV_Objective + (1+IV_Objective|ID))

# hypothesis-driven model fall, simple (converges, no error message) 
model1.fall.simple.adult <- lmer(data = exp1_fall, formula = DV_Subj_Fall ~ IV_Objective + (1|ID))

# hypothesis-driven model fall, standardized, simple (converges, no error message)
model1.fall.standard.adult <- lmer(data = exp1_fall, formula = scale(DV_Subj_Fall) ~ scale(IV_Objective) + (1|ID))

# task 1 fall summaries
confint(model1.fall.simple.adult)
summary(model1.fall.simple.adult)
summary(model1.fall.standard.adult)

# likelihood ratio test for comparing models (fall)
anova(null1.fall.simple.adult, model1.fall.simple.adult)

# r-squared For generalized mixed-effect models
r.squaredGLMM(null1.fall.simple.adult)
r.squaredGLMM(model1.fall.simple.adult) # adding predictors adds 31.31% variance explained 
```

## Task 1: Power Analyses
```{r exp1.jump.power.analysis, echo=FALSE, eval=FALSE}
sim1.jump.adult <- powerCurve(extend(model1.jump.adult, along="ID", n=500),along="ID", breaks = c(2, 4, 6, 8), alpha = .05, seed = 123)
plot(sim1.jump.adult)
print(sim1.jump.adult)
```

```{r exp1.fall.power.analysis, echo=FALSE, eval=FALSE}
sim1.fall.adult <- powerCurve(extend(model1.fall.adult, along="ID", n=500), along="ID", breaks = c(2, 4, 6, 8), alpha = .05, seed = 123)
plot(sim1.fall.adult)
print(sim1.fall.adult)
```

## Task 1: Exploratory Analyses

### T1: Non-linear Bootstrap Analysis (Jump) 
```{r exp1.jump.analysis.bootstrap, cache=TRUE}
set.seed(123)

# compile original data for sampling
data1.jump <- data %>%
  select(ID, Version, contains("Jump"))

# prepare sampled data
cleaning1.jump <- function(new_data) {
  final.jump <- new_data %>%
  gather(orig2, DV_Subj_Jump, contains("Jump")) %>% 
  separate(orig2, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
  mutate(DV_Subj_Jump = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Jump), as.numeric(DV_Subj_Jump)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>% 
  arrange(ID) 
  
  return(final.jump)
}

# retrieve AIC difference between linear and non-linear models
myAIC <- function(original, sample) {
  new_data <- original[sample, ]
  boot_data <- cleaning1.jump(new_data)
  
  boot.model1.jump.adult <- lmer(data = boot_data, formula = DV_Subj_Jump ~ IV_Objective + (1|ID))
  AIC1 <- AIC(boot.model1.jump.adult)
  
  boot.model1.expo.decay.jump.adult <- lmer(data = boot_data, formula = DV_Subj_Jump ~ I(exp(-IV_Objective)) + (1|ID))
  AIC2 <- AIC(boot.model1.expo.decay.jump.adult)
  
  return(AIC2-AIC1)               
} 

# bootstrap AIC function
boot.AIC.jump.adult <- boot(data1.jump, statistic = myAIC, R = 1000) 
boot.AIC.jump.adult

# confidence intervals
quantile(boot.AIC.jump.adult$t, probs = c(0.025, 0.975)) 

# mean
mean(boot.AIC.jump.adult$t)
```

### T1: Non-linear Bootstrap Analysis (Fall)
```{r exp1.fall.analysis.bootstrap, cache=TRUE}
set.seed(123)

# compile original data
data1.fall <- data %>%
  select(ID, Version, contains("Fall"))

# prepare sampled data
cleaning1.fall <- function(new_data) {
  final <- new_data %>%
  gather(orig2, DV_Subj_Fall, contains("Fall")) %>% 
  separate(orig2, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
  mutate(DV_Subj_Fall = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Fall), as.numeric(DV_Subj_Fall)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>% 
  arrange(ID) 
  
  return(final)
}

# retrieve AIC difference between linear and non-linear models
myAIC <- function(original, sample) {
  new_data <- original[sample, ]
  boot_data <- cleaning1.fall(new_data)

  boot.model1.fall.adult <- lmer(data = boot_data, formula = DV_Subj_Fall ~ IV_Objective + (1|ID))
  AIC1 <- AIC(boot.model1.fall.adult)
  
  boot.model1.expo.decay.fall.adult <- lmer(data = boot_data, formula = DV_Subj_Fall ~ I(exp(-IV_Objective)) + (1|ID))
  AIC2 <- AIC(boot.model1.expo.decay.fall.adult)
  
  return(AIC2-AIC1)       
} 

# bootstrap AIC function
boot.AIC.fall.adult <- boot(data1.fall, statistic = myAIC, R = 1000) 
boot.AIC.fall.adult

# confidence intervals
quantile(boot.AIC.fall.adult$t, probs = c(0.025, 0.975)) 

# mean
mean(boot.AIC.fall.adult$t)
```

### T1: T-Test and Correlation Analysis
```{r exp1.analysis.extra}
# t test between jump and fall values
t.test(exp1_full$DV_Subj_Fall, exp1_full$DV_Subj_Jump, paired = TRUE)

# mean and standard deviations to supplement t test
mean(exp1_full$DV_Subj_Fall, na.rm=TRUE)
sd(exp1_full$DV_Subj_Fall, na.rm=TRUE)
mean(exp1_full$DV_Subj_Jump, na.rm=TRUE)
sd(exp1_full$DV_Subj_Jump, na.rm=TRUE)

# regression between jump and fall values
subj.corr.adult <- lmer(data = exp1_full, formula = DV_Subj_Fall ~ DV_Subj_Jump + (1|ID))
summary(subj.corr.adult)
confint(subj.corr.adult)

# correlation between jump and fall values
cor.test(exp1_full$DV_Subj_Fall, exp1_full$DV_Subj_Jump)
```








# Task 2

## Task 2: Tidy Data
```{r exp2, echo=FALSE}
exp2 <- data %>%
  select(ID, Version, contains("Exp2.Test")) %>% # select Task 2 trials, ID, and Version
  gather(orig, DV_Direction, contains("Exp2.Test")) %>% # split trials into rows
  separate(orig, c("IV_Depth","Exp"), sep = "([\\_\\.])", extra = "drop") %>% # separate trial number
  mutate(IV_Depth = as.numeric(sub("X","", IV_Depth)), IV_Obj_Depth_Diff = IV_Depth - 4, DV_Direction = ifelse(Version %in% "B", 100 - as.numeric(DV_Direction), as.numeric(DV_Direction))) %>% # find depth, adjust for counterbalancing in Version B
  arrange(ID) # arrange by ID number
```

## Task 2: Plots
```{r exp2.plot, echo=FALSE, eval=FALSE}
# produce Task 2 plot
(exp2.plot.adult <- exp2 %>% 
  ggplot(aes(x = IV_Obj_Depth_Diff, y= DV_Direction)) +
  scale_x_continuous(breaks=seq(-3,3,1)) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.1, size=.8) +
  geom_boxplot(aes(group=IV_Obj_Depth_Diff), color="#333333", width=.5, fill=NA, size=1) +
  geom_point(color="#5F8DAE", size=3) +
  stat_summary(fun.data="mean_cl_boot", geom="errorbar", color="#003e67", width=0.2, size=1.5) +
  stat_summary(fun="mean", geom="point", shape=23, size=4, fill="white", color="#003e67", stroke=2) +
  theme_bw() +
  theme(axis.text=element_text(size=23)) +
  labs(x = "", y = "") +
  coord_flip() )

ggsave(filename="task2.adult.plot.png", path="/Users/Nensi/Desktop", width = 30, height = 21, units = "cm", dpi=300)
```

```{r exp2.plot.indv, echo=FALSE, eval=FALSE}
# produce Task 2 plot (individual graph per participant)
(exp2.plot.indv.adult <- exp2 %>% 
  ggplot(aes(x = IV_Obj_Depth_Diff, y= DV_Direction)) +
  scale_x_continuous(breaks=seq(-3,3,1)) +
  facet_wrap(vars(ID), ncol = 6) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.2, size=1.5) +
  geom_point(color="#5F8DAE", size=3) +
  theme_bw() +
  theme(axis.text=element_text(size=13)) +
  ylim(0, 100) +
  labs(x = "", y = "") +
  coord_flip() )

ggsave(filename="task2.adult.indv.png", path="/Users/Nensi/Desktop", width = 36, height = 30, units = "cm", dpi=300)
```

## Task 2: Main Analysis
```{r exp2.analysis}
# null model (converges, singular error message)
null2.adult <- lmer(data = exp2, formula = DV_Direction ~ 1 + (1+IV_Obj_Depth_Diff|ID))

# hypothesis-driven model (converges, singular error message)
model2.adult <- lmer(data = exp2, formula = DV_Direction ~ IV_Obj_Depth_Diff + (1+IV_Obj_Depth_Diff|ID))

# standardized model (converges, singular error message)
model2.standard.adult <- lmer(data = exp2, formula = scale(DV_Direction) ~ scale(IV_Obj_Depth_Diff) + (1+scale(IV_Obj_Depth_Diff)|ID))

# task 2 summaries
confint(model2.adult, method="boot")
summary(model2.adult)
summary(model2.standard.adult)

# likelihood ratio test for comparing models
anova(null2.adult, model2.adult)

# r-squared For generalized mixed-effect models
r.squaredGLMM(null2.adult)
r.squaredGLMM(model2.adult) # adding predictors adds 60.07% variance explained 

# summary stats
exp2 %>% group_by(IV_Obj_Depth_Diff) %>%
    summarise(mean = ci(DV_Direction)[1], 
                     lowCI = ci(DV_Direction)[2],
                     hiCI = ci(DV_Direction)[3], 
                     sd = ci (DV_Direction)[4])
```

## Task 2: Power Analysis
```{r exp2.power.analysis, echo=FALSE, eval=FALSE}
sim2.adult <- powerCurve(extend(model2.adult, along="ID", n=500), along="ID", breaks = c(1, 3, 5), alpha = .05, seed = 123)
plot(sim2.adult)
print(sim2.adult)
```

## Task 2: Non-linear Bootstrap Analysis
```{r exp2.bootstrap, cache=TRUE}
set.seed(123)

data2 <- data %>%
  select(ID, contains("Exp2.Test"), Version)

cleaning2 <- function(new_data) {
  final <- new_data %>%
  gather(orig, DV_Direction, contains("Exp2.Test")) %>%
  separate(orig, c("IV_Depth","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
  mutate(IV_Depth = as.numeric(sub("X","", IV_Depth)), IV_Obj_Depth_Diff = IV_Depth - 4, DV_Direction = ifelse(Version %in% "B", 100 - as.numeric(DV_Direction), as.numeric(DV_Direction))) %>% 
    arrange(ID)
  
  return(final)
}

myAIC <- function(original, sample) {
  new_data <- original[sample,]
  boot_data <- cleaning2(new_data)
  
  boot.model2.adult <- lmer(data = boot_data, formula = DV_Direction ~ IV_Obj_Depth_Diff + (1|ID))
  AIC1 <- AIC(boot.model2.adult)
  
  boot.model2.logistic.adult <- lmer(data = boot_data, formula = DV_Direction ~ I(((1+exp(IV_Obj_Depth_Diff))^(-1))) + (1|ID))
  AIC2 <- AIC(boot.model2.logistic.adult)
  
  return(AIC2-AIC1)               
} 

# bootstrap AIC function
boot.AIC.exp2.adult <- boot(data2, statistic = myAIC, R = 1000) 
boot.AIC.exp2.adult

# confidence intervals
quantile(boot.AIC.exp2.adult$t, probs = c(0.025, 0.975)) 

#mean
mean(boot.AIC.exp2.adult$t)
```






# Task 3

## Task 3: Tidy Data
```{r exp3, echo=FALSE}
exp3 <- data %>%
  select(ID, Version, contains("Exp3.Test")) %>% # select Task 3 trials, ID, and Version
  gather(orig, DV_Preference, contains("Exp3.Test")) %>% # split trials into rows
  separate(orig, c("IV_Depth_Accept","Exp"), sep = "([\\_\\.])", extra = "drop") %>% # separate trial number
  mutate(IV_Depth_Accept = as.numeric(sub("X","", IV_Depth_Accept)), DV_Preference = ifelse(Version %in% "A", 100 - as.numeric(DV_Preference), as.numeric(DV_Preference))) %>% # find depth, adjust for counterbalancing
  arrange(ID) # arrange by ID number
```

## Task 3: Plots
```{r exp3.plot, echo=FALSE, eval=FALSE}
(exp3.plot.adult <- exp3 %>% 
  ggplot(aes(x = IV_Depth_Accept, y = DV_Preference)) +
  scale_x_continuous(breaks=seq(1,5,1)) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.1, size=.8) +
  geom_boxplot(aes(group=IV_Depth_Accept), color="#333333", width=.4, fill=NA, size=1) +
  geom_point(color="#5F8DAE", size=3) +
  stat_summary(fun.data="mean_cl_boot", geom="errorbar", color="#003e67", width=0.15, size=1.5) +
  stat_summary(fun="mean", geom="point", shape=23, size=4, fill="white", color="#003e67", stroke=2) +
  theme_bw() +
  theme(axis.text=element_text(size=23)) +
  labs(x = "", y = ""))

ggsave(filename="task3.adult.plot.png", path="/Users/Nensi/Desktop", width = 30, height = 21, units = "cm", dpi=300)
```

```{r exp3.plot.indv, echo=FALSE, eval=FALSE}
(exp3.plot.indv.adult <- exp3 %>% 
  ggplot(aes(x = IV_Depth_Accept, y = DV_Preference)) +
  scale_x_continuous(breaks=seq(1,5,1)) +
  facet_wrap(vars(ID), ncol = 6) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.2, size=1.5) +
  geom_point(color="#5F8DAE", size=3) +
  theme_bw() +
  theme(axis.text=element_text(size=13)) +
  ylim(0, 100) +
  labs(x = "", y = ""))

ggsave(filename="task3.adult.indv.png", path="/Users/Nensi/Desktop", width = 36, height = 30, units = "cm", dpi=300)
```

## Task 3: Main Analysis
```{r exp3.analysis}
# null model (converges, no error message)
null3.adult <- lmer(data = exp3, formula = DV_Preference ~ 1 + (1+IV_Depth_Accept|ID))

# hypothesis-driven model (converges, no error message)
model3.adult <- lmer(data = exp3, formula = DV_Preference ~ IV_Depth_Accept + (1+IV_Depth_Accept|ID))

# hypothesis-driven standardized (converges, no error message)
model3.standard.adult <- lmer(data = exp3, formula = scale(DV_Preference) ~ scale(IV_Depth_Accept) + (1+scale(IV_Depth_Accept)|ID))

# task 3 summaries
confint(model3.adult)
summary(model3.adult)
summary(model3.standard.adult)

# likelihood ratio test for comparing models
anova(null3.adult, model3.adult) 

# r-squared For generalized mixed-effect models
r.squaredGLMM(null3.adult)
r.squaredGLMM(model3.adult) # adding predictors adds 7.06% variance explained 
```

## Task 3: Power Analysis
```{r exp3.power.analysis, echo=FALSE, eval=FALSE}
sim3.adult <- powerCurve(extend(model3.adult, along="ID", n=120), along="ID", breaks = c(40, 60, 80), alpha = .05, seed = 123)
plot(sim3.adult)
print(sim3.adult)
```

## Task 3: Non-linear Bootstrap Analysis
```{r exp3.bootstrap, cache=TRUE}
set.seed(123)

data3 <- data %>%
  select(ID, contains("Exp3.Test"), Version)

cleaning3 <- function(new_data) {
  final <- new_data %>%
  gather(orig, DV_Preference, contains("Exp3.Test")) %>% # split trials into rows
  separate(orig, c("IV_Depth_Accept","Exp"), sep = "([\\_\\.])", extra = "drop") %>% # separate trial number
  mutate(IV_Depth_Accept = as.numeric(sub("X","", IV_Depth_Accept)), DV_Preference = ifelse(Version %in% "A", 100 - as.numeric(DV_Preference), as.numeric(DV_Preference))) %>% # find depth, adjust for counterbalancing
  arrange(ID)

  return(final)
}

# retrieve AIC difference between linear and non-linear models
myAIC <- function(original, sample) {
  new_data <- original[sample,]
  boot_data <- cleaning3(new_data)

  boot.model3.adult <- lmer(data = boot_data, formula = DV_Preference ~ IV_Depth_Accept + (1|ID))
  AIC1 <- AIC(boot.model3.adult)
  
  boot.model3.logarithmic.adult <- lmer(data = boot_data, formula = DV_Preference ~ I(log(IV_Depth_Accept)) + (1|ID))
  AIC2 <- AIC(boot.model3.logarithmic.adult)

  return(AIC2-AIC1)               
} 

# bootstrap AIC function
boot.AIC.exp3.adult <- boot(data3, statistic = myAIC, R = 1000) 
boot.AIC.exp3.adult

# confidence intervals
quantile(boot.AIC.exp3.adult$t, probs = c(0.025, 0.975)) 

#mean
mean(boot.AIC.exp3.adult$t)
```






# Task 4

## Task 4: Tidy Data
```{r exp4, echo=FALSE}
exp4 <- data %>%
  select(ID, Version, contains("Exp4.Test")) %>% # select Task 4 trials, ID, and Version
  gather(orig, DV_Depth, contains("Exp4.Test")) %>% # split trials into rows
  separate(orig, c("IV_Preference","Exp"), sep = "([\\_\\.])", extra = "drop") %>% # separate trial number
  mutate(IV_Preference = as.numeric(sub("X","", IV_Preference)), DV_Depth = ifelse(Version %in% "A", 100 - as.numeric(DV_Depth), as.numeric(DV_Depth))) %>% # find preference, adjust for counterbalancing
  arrange(ID) # arrange by ID number

```

## Task 4: Plots
```{r exp4.plot, echo=FALSE, eval=FALSE}
(exp4.plot.adult <- exp4 %>% 
  ggplot(aes(x = IV_Preference, y = DV_Depth)) +
  scale_x_continuous(breaks=seq(1,7,1)) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.1, size=.8) +
  geom_boxplot(aes(group=IV_Preference), color="#333333", width=.5, fill=NA, size=1) +
  geom_point(color="#5F8DAE", size=3) +
  stat_summary(fun.data="mean_cl_boot", geom="errorbar", color="#003e67", width=0.15, size=1.5) +
  stat_summary(fun="mean", geom="point", shape=23, size=4, fill="white", color="#003e67", stroke=2) +
  theme_bw() +
  theme(axis.text=element_text(size=23)) +
  labs(x = "", y = ""))

ggsave(filename="task4.adult.plot.png", path="/Users/Nensi/Desktop", width = 30, height = 20, units = "cm", dpi=300)
```

```{r exp4.plot.indv, echo=FALSE, eval=FALSE}
(exp4.plot.indv.adult <- exp4 %>% 
  ggplot(aes(x = IV_Preference, y = DV_Depth)) +
  scale_x_continuous(breaks=seq(1,7,1)) +
  facet_wrap(vars(ID), ncol = 6) +
  geom_line(aes(group=ID), color=rgb(0,0,0), alpha=0.2, size=1.5) +
  geom_point(color="#5F8DAE", size=3) +
  theme_bw() +
  theme(axis.text=element_text(size=13)) +
  ylim(0, 100) +
  labs(x = "", y = ""))

ggsave(filename="task4.adult.indv.png", path="/Users/Nensi/Desktop", width = 36, height = 30, units = "cm", dpi=300)

```

## Task 4: Main Analysis
```{r exp4.analysis}
#null model (failed to converge)
#null4.adult <- lmer(data = exp4, formula = DV_Depth ~ 1 + (1+IV_Preference|ID))

#null model simplified (converges, singular error message)
null4.simple.adult <- lmer(data = exp4, formula = DV_Depth ~ 1 + (1|ID))

# hypothesis-driven model (converges, no error message)
model4.adult <- lmer(data = exp4, formula = DV_Depth ~ IV_Preference + (1+IV_Preference|ID))

# hypothesis-driven model, simplified (converges, no error message)
model4.simple.adult <- lmer(data = exp4, formula = DV_Depth ~ IV_Preference + (1|ID))

# hypothesis-driven model simplified, standardized
model4.standard.adult <- lmer(data = exp4, formula = scale(DV_Depth) ~ scale(IV_Preference) + (1|ID))

# task 4 summaries
confint(model4.simple.adult)
summary(model4.simple.adult)
summary(model4.standard.adult)

# likelihood ratio test for comparing models
anova(null4.simple.adult, model4.simple.adult) 

# r-squared For generalized mixed-effect models
r.squaredGLMM(null4.simple.adult)
r.squaredGLMM(model4.simple.adult) # adding predictors adds 50.35% variance explained 
```

## Task 4: Power Analysis
```{r exp4.power.analysis, echo=FALSE, eval=FALSE}
sim4.adult <- powerCurve(extend(model4.adult, along="ID", n=500),along="ID", breaks = c(2, 4, 6, 8), alpha = .05, seed = 123)
plot(sim4.adult)
print(sim4.adult)
```

## Task 4: Nonlinear Bootstrap Analysis
```{r exp4.bootstrap, cache=TRUE}
set.seed(123)

data4 <- data %>%
  select(ID, contains("Exp4.Test"), Version)

cleaning4 <- function(new_data) {
  final <- new_data %>%
  gather(orig, DV_Depth, contains("Exp4.Test")) %>%
  separate(orig, c("IV_Preference","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
  mutate(IV_Preference = as.numeric(sub("X","", IV_Preference)), DV_Depth = ifelse(Version %in% "A", 100 - as.numeric(DV_Depth), as.numeric(DV_Depth))) %>% 
  arrange(ID)

  return(final)
}

# retrieve AIC difference between linear and non-linear models
myAIC <- function(original, sample) {
  new_data <- original[sample,]
  boot_data <- cleaning4(new_data)

  boot.model4.adult <- lmer(data = boot_data, formula = DV_Depth ~ IV_Preference + (1|ID))
  AIC1 <- AIC(boot.model4.adult)
  
  boot.model4.logarithmic.adult <- lmer(data = boot_data, formula = DV_Depth ~ I(log(IV_Preference)) + (1|ID))
  AIC2 <- AIC(boot.model4.logarithmic.adult)
  
  return(AIC2-AIC1)               
} 

# bootstrap AIC function
boot.AIC.exp4.adult <- boot(data4, statistic = myAIC, R = 1000) 
boot.AIC.exp4.adult

# confidence intervals
quantile(boot.AIC.exp4.adult$t, probs = c(0.025, 0.975)) 

#mean
mean(boot.AIC.exp4.adult$t)
```






## Across-Task Correlation
```{r tau.analysis, cache=TRUE}
exp1.fall.tau.adult <- exp1_fall %>%
  group_by(ID) %>%
  summarise(task1b = 
  cor.test(IV_Objective,DV_Subj_Fall*-1, method="kendall")$estimate) %>%
  mutate(task1b.z = scale(task1b))

exp1.jump.tau.adult <- exp1_jump %>%
  group_by(ID) %>%
  summarise(task1a = 
  cor.test(IV_Objective,DV_Subj_Jump*-1, method="kendall")$estimate) %>%
    mutate(task1a.z = scale(task1a))

exp2.tau.adult <- exp2 %>%
  group_by(ID) %>%
  summarise(task2 = 
  cor.test(DV_Direction,IV_Obj_Depth_Diff, method="kendall")$estimate)%>%
    mutate(task2.z = scale(task2))

exp3.tau.adult <- exp3 %>%
  group_by(ID) %>%
  summarise(task3 = 
  cor.test(DV_Preference,IV_Depth_Accept, method="kendall")$estimate)%>%
    mutate(task3.z = scale(task3))

exp4.tau.adult <- exp4 %>%
  group_by(ID) %>%
  summarise(task4 = 
  cor.test(DV_Depth,IV_Preference, method="kendall")$estimate)%>%
    mutate(task4.z = scale(task4))

taus.exp1.adult <- full_join(exp1.jump.tau.adult, exp1.fall.tau.adult)
taus.exp12.adult <- full_join(taus.exp1.adult, exp2.tau.adult)
taus.exp123.adult <- full_join(taus.exp12.adult, exp3.tau.adult)
taus.adult <- full_join(taus.exp123.adult, exp4.tau.adult)
taus.t.adult <- select(taus.adult, !contains("z"))
taus.z.adult <- select(taus.adult, contains("z")) %>%
  rename(task1a =task1a.z,
          task1b = task1b.z,
          task2 = task2.z,
          task3 = task3.z,
          task4 = task4.z)

cor.mat.adult <- cor(taus.z.adult, method = "kendall",use="complete.obs")
# mat : is a matrix of data
# ... : further arguments to pass to the native R cor.test function

cor.mtest.adult <- function(mat, ...) {
    mat <- as.matrix(mat)
    n <- ncol(mat)
    p.mat<- matrix(NA, n, n)
    diag(p.mat) <- 0
    for (i in 1:(n - 1)) {
        for (j in (i + 1):n) {
            tmp <- cor.test(mat[, i], mat[, j], method="kendall",...)
            p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
        }
    }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}

p.mat.adult <- cor.mtest.adult(taus.z.adult)

corrplot::corrplot(cor.mat.adult, method="color",
                   # type="lower",
                   order="original",
                   outline=TRUE,
                   tl.col="black",
                   addCoef.col = "black",
                   sig.level = 0.05, 
                   cl.align.text = "l",
                   insig = "pch",
                   p.mat=p.mat.adult)
```






# Subjective Exploratory Analyses

## Subjective Applied to Task 2 Analysis
```{r exploratory.subj.analyses.original.AICs.Exp.2, cache=TRUE}
exp1_full_edit2 <- exp1_full %>%
  rename(IV_Depth = IV_Objective) %>% 
  select(-Version, -Exp)

exp2_sub <- full_join(exp2, exp1_full_edit2, by=c("ID", "IV_Depth")) %>% 
  filter(!(ID=="33" & IV_Depth=="1"), !(ID=="51" & IV_Depth=="3"), !(ID=="106" & IV_Depth=="5")) %>%
  arrange(ID)

# Comparing Subjective v Objective Danger Assessments (Exp. 2)
# Objective
sub.model2.adult <- lmer(data = exp2_sub, formula = DV_Direction ~ IV_Obj_Depth_Diff + (1|ID), na.action = na.exclude)
# summary(sub.model2.adult)

# Jump
sub.model2.jump.adult <- lmer(data = exp2_sub, formula = DV_Direction ~ DV_Subj_Jump_Diff + (1|ID), na.action = na.exclude)
# summary(sub.model2.jump.adult)

# Fall
sub.model2.fall.adult <- lmer(data = exp2_sub, formula = DV_Direction ~ DV_Subj_Fall_Diff + (1|ID), na.action = na.exclude)
# summary(sub.model2.fall.adult)

# Jump Objective
sub.model2.jump.obj.adult <- lmer(data = exp2_sub, formula = DV_Direction ~ DV_Subj_Jump_Diff + IV_Obj_Depth_Diff + (1|ID), na.action = na.exclude)
# summary(sub.model2.jump.obj.adult)

# Fall Objective
sub.model2.fall.obj.adult <- lmer(data = exp2_sub, formula = DV_Direction ~ DV_Subj_Fall_Diff + IV_Obj_Depth_Diff + (1|ID), na.action = na.exclude)
# summary(sub.model2.fall.obj.adult)

# Jump Fall
sub.model2.jump.fall.adult  <- lmer(data = exp2_sub, formula = DV_Direction ~ DV_Subj_Jump_Diff + DV_Subj_Fall_Diff + (1|ID), na.action = na.exclude)
# summary(sub.model2.jump.fall.adult)

# Full
sub.model2.full.adult <- lmer(data = exp2_sub, formula = DV_Direction ~ DV_Subj_Jump_Diff + DV_Subj_Fall_Diff + IV_Obj_Depth_Diff + (1|ID), na.action = na.exclude)
# summary(sub.model2.full.adult)

# Full, scaled
sub.model2.full.adult.scaled <- lmer(data = exp2_sub, formula = scale(DV_Direction) ~ scale(DV_Subj_Jump_Diff) + scale(DV_Subj_Fall_Diff) + scale(IV_Obj_Depth_Diff) + (1|ID), na.action = na.exclude)

# compare AICs
anova(sub.model2.adult, sub.model2.jump.adult, sub.model2.fall.adult, sub.model2.jump.obj.adult, sub.model2.fall.obj.adult, sub.model2.jump.fall.adult, sub.model2.full.adult)

# variance analysis
r.squaredGLMM(sub.model2.adult)
r.squaredGLMM(sub.model2.full.adult) # adding mental state predictors adds 0.75% variance explained 

summary(sub.model2.full.adult)
summary(sub.model2.full.adult.scaled)

confint(sub.model2.full.adult)
```

## Subjective Applied to Task 3 Analysis
```{r exploratory.subj.analyses.original.AICs.Exp.3, cache=TRUE}
exp1_full_edit3 <- exp1_full %>%
  filter(IV_Objective < 6) %>% 
  rename(IV_Depth_Accept = IV_Objective) %>% 
  select(-Version, -Exp)

exp3_sub <- full_join(exp3, exp1_full_edit3, by=c("ID", "IV_Depth_Accept")) %>% 
  filter(!(ID=="33" & IV_Depth_Accept=="1"), !(ID=="51" & IV_Depth_Accept=="3"), !(ID=="106" & IV_Depth_Accept=="5")) %>% 
  select(-DV_Subj_Fall_Diff, -DV_Subj_Jump_Diff, -DV_Subj_Fall_Baseline, -DV_Subj_Jump_Baseline) %>% 
  arrange(ID)

# Comparing Subjective v Objective Danger Assessments (Exp. 3)
# Objective
sub.model3.adult <- lmer(data = exp3_sub, formula = DV_Preference ~ IV_Depth_Accept + (1|ID), na.action = na.exclude)
# summary(sub.model3.adult)

# Jump
sub.model3.jump.adult <- lmer(data = exp3_sub, formula = DV_Preference ~ DV_Subj_Jump + (1|ID), na.action = na.exclude)
# summary(sub.model3.jump.adult)

# Fall
sub.model3.fall.adult <- lmer(data = exp3_sub, formula = DV_Preference ~ DV_Subj_Fall + (1|ID), na.action = na.exclude)
# summary(sub.model3.fall.adult)

# Jump Objective
sub.model3.jump.obj.adult <- lmer(data = exp3_sub, formula = DV_Preference ~ DV_Subj_Jump + IV_Depth_Accept + (1|ID), na.action = na.exclude)
# summary(sub.model3.jump.obj.adult)

# Fall Objective
sub.model3.fall.obj.adult <- lmer(data = exp3_sub, formula = DV_Preference ~ DV_Subj_Fall + IV_Depth_Accept + (1|ID), na.action = na.exclude)
# summary(sub.model3.fall.obj.adult)

# Jump Fall
sub.model3.jump.fall.adult <- lmer(data = exp3_sub, formula = DV_Preference ~ DV_Subj_Jump + DV_Subj_Fall + (1|ID), na.action = na.exclude)
# summary(sub.model3.jump.fall.adult)

# Full
sub.model3.full.adult <- lmer(data = exp3_sub, formula = DV_Preference ~ DV_Subj_Jump + DV_Subj_Fall + IV_Depth_Accept + (1|ID), na.action = na.exclude)
# summary(sub.model3.full.adult)

# Full, scaled
sub.model3.full.adult.scaled <- lmer(data = exp3_sub, formula = scale(DV_Preference) ~ scale(DV_Subj_Jump) + scale(DV_Subj_Fall) + scale(IV_Depth_Accept) + (1|ID), na.action = na.exclude)

# compare AICs
anova(sub.model3.adult, sub.model3.jump.adult, sub.model3.fall.adult, sub.model3.jump.obj.adult, sub.model3.fall.obj.adult, sub.model3.jump.fall.adult, sub.model3.full.adult)

# variance analysis
r.squaredGLMM(sub.model3.adult)
r.squaredGLMM(sub.model3.full.adult) # adding mental state predictors adds 0.21% variance explained

summary(sub.model3.full.adult)
summary(sub.model3.full.adult.scaled)

confint(sub.model3.full.adult)
```

## Subjective Bootstrap on Task 2 Analysis
```{r exploratory.subj.analyses.bootstrap.AICs.Exp.2, cache=TRUE}
set.seed(123)

# compile all relevant experiments for bootstrap sampling by ID
data1.sub <- data  %>%
  select(ID, Version, contains("Jump"), contains("Fall"), contains("Exp2.Test"))

# individually gather exp. 1 under sampled IDs
cleaning1.sub <- function(new_data) {

  sub1.jump <- new_data %>%
    select(ID, Version, contains("Jump")) %>%  
    gather(orig, DV_Subj_Jump, contains("Jump")) %>% 
    separate(orig, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
    mutate(DV_Subj_Jump = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Jump),  as.numeric(DV_Subj_Jump)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>%
    arrange(ID) %>% 
    mutate(row=row_number())
  
  sub1.fall <- new_data %>%
    select(ID, Version, contains("Fall")) %>%
    gather(orig2, DV_Subj_Fall, contains("Fall")) %>% 
    separate(orig2, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
    mutate(DV_Subj_Fall = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Fall), as.numeric(DV_Subj_Fall)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>% 
    arrange(ID) %>% 
    mutate(row=row_number()) 
    
  # find baseline values for jump
  sub1.baseline_jump <- sub1.jump %>%
    select(ID, IV_Objective, DV_Subj_Jump) %>%
    filter(IV_Objective == "4") %>% 
    mutate(count = 7) %>% 
    uncount(count) %>%
    rename(DV_Subj_Jump_Baseline = DV_Subj_Jump) %>% 
    select(DV_Subj_Jump_Baseline)
    
  # find baseline values for fall
  sub1.baseline_fall <- sub1.fall %>%
    select(ID, IV_Objective, DV_Subj_Fall) %>% 
    filter(IV_Objective == "4") %>% 
    mutate(count = 7) %>%
    uncount(count) %>% 
    rename(DV_Subj_Fall_Baseline = DV_Subj_Fall) %>% 
    select(DV_Subj_Fall_Baseline)
  
  # compile final jump data
  sub1.jump <- cbind(sub1.jump, sub1.baseline_jump) %>% 
    mutate(DV_Subj_Jump_Diff = DV_Subj_Jump - DV_Subj_Jump_Baseline)
  
  # compile final fall data
  sub1.fall <- cbind(sub1.fall, sub1.baseline_fall) %>% 
    mutate(DV_Subj_Fall_Diff = DV_Subj_Fall - DV_Subj_Fall_Baseline) %>% 
    select(-Exp, -IV_Objective, -Version, -ID)

  # compile combined dataset with participant exclusions (incomplete trials)
  sub1_full <- merge(sub1.jump, sub1.fall, c("row"="row")) %>% 
    rename(IV_Depth = IV_Objective) %>% 
    filter(!(ID=="33" & IV_Depth=="1"), !(ID=="51" & IV_Depth=="3"), !(ID=="106" & IV_Depth=="5")) %>%  
    select(-row, -Exp, - Version) %>% 
    arrange(ID) 
  
  return(sub1_full)
}

# individually gather exp. 2 under sampled IDs
cleaning2.sub <- function(new_data) {
  final <- new_data %>%
  select(ID, Version, contains("Exp2.Test")) %>% 
  gather(orig, DV_Direction, contains("Exp2.Test")) %>%
  separate(orig, c("IV_Depth","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
  mutate(IV_Depth = as.numeric(sub("X","", IV_Depth)), IV_Obj_Depth_Diff = IV_Depth - 4, DV_Direction = ifelse(Version %in% "B", 100 - as.numeric(DV_Direction), as.numeric(DV_Direction))) %>%
  filter(!(ID=="33" & IV_Depth=="1"), !(ID=="51" & IV_Depth=="3"), !(ID=="106" & IV_Depth=="5")) %>% 
    arrange(ID)
  
  return(final)
}

# Comparing Subjective v Objective Danger Assessments (Exp. 2) 

# retrieve AIC difference between two lowest AIC models
myAIC <- function(original, sample) {
  new_data <- original[sample,]
  
  boot_data1 <- cleaning1.sub(new_data)
  boot_data2 <- cleaning2.sub(new_data)
  
  boot_data <- cbind(boot_data1, boot_data2)
  
  
  boot.sub.model2.jump.obj.adult <- lmer(data = boot_data, formula = DV_Direction ~ DV_Subj_Jump_Diff + IV_Obj_Depth_Diff + (1|ID), na.action = na.exclude)
  AIC1 <- AIC(boot.sub.model2.jump.obj.adult)
  
  boot.sub.model2.full <- lmer(data = boot_data, formula = DV_Direction ~ DV_Subj_Jump_Diff + DV_Subj_Fall_Diff + IV_Obj_Depth_Diff + (1|ID), na.action = na.exclude)
  AIC2 <- AIC(boot.sub.model2.full)
  
  return(AIC2-AIC1)               
} 

# bootstrap AIC function
boot.AIC.sub2.adult <- boot(data1.sub, statistic = myAIC, R = 1000) 
boot.AIC.sub2.adult

# confidence intervals
quantile(boot.AIC.sub2.adult$t, probs = c(0.025, 0.975)) 

#mean
mean(boot.AIC.sub2.adult$t)
```

## Subjective Bootstrap on Task 3 Analysis
```{r exploratory.subj.analyses.bootstrap.AICs.Exp.3, cache=TRUE}
set.seed(123)

# compile all relevant experiments for bootstrap sampling by ID
data3.sub <- data  %>%
  select(ID, Version, contains("Jump"), contains("Fall"), contains("Exp3.Test"))

# individually gather exp. 1 under sampled IDs
cleaning1b.sub <- function(new_data) {

  sub1b.jump <- new_data %>%
    select(ID, Version, contains("Jump")) %>%  
    gather(orig, DV_Subj_Jump, contains("Jump")) %>% 
    separate(orig, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
    mutate(DV_Subj_Jump = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Jump),  as.numeric(DV_Subj_Jump)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>%
    arrange(ID) %>% 
    mutate(row=row_number())
  
  sub1b.fall <- new_data %>%
    select(ID, Version, contains("Fall")) %>%
    gather(orig2, DV_Subj_Fall, contains("Fall")) %>% 
    separate(orig2, c("IV_Objective","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
    mutate(DV_Subj_Fall = ifelse(Version %in% "A", 100 - as.numeric(DV_Subj_Fall), as.numeric(DV_Subj_Fall)), IV_Objective = as.numeric(sub("X","", IV_Objective))) %>% 
    arrange(ID) %>% 
    select(-ID, -IV_Objective, -Exp, - Version) %>% 
    mutate(row=row_number()) 

  # compile combined dataset with participant exclusions (incomplete trials)
  sub1b_full <- merge(sub1b.jump, sub1b.fall, c("row"="row")) %>% 
    rename(IV_Depth_Accept = IV_Objective) %>% 
    filter(!(ID=="33" & IV_Depth_Accept=="1"), !(ID=="51" & IV_Depth_Accept=="3"), !(ID=="106" & IV_Depth_Accept=="5")) %>%  
    filter(IV_Depth_Accept < 6) %>% 
    select(-row, -Exp, - Version) %>% 
    arrange(ID) 

  return(sub1b_full)
}

# individually gather exp. 2 under sampled IDs
cleaning3.sub <- function(new_data) {
  final <- new_data %>%
  select(ID, Version, contains("Exp3.Test")) %>% 
  gather(orig, DV_Preference, contains("Exp3.Test")) %>% 
  separate(orig, c("IV_Depth_Accept","Exp"), sep = "([\\_\\.])", extra = "drop") %>% 
  mutate(IV_Depth_Accept = as.numeric(sub("X","", IV_Depth_Accept)), DV_Preference = ifelse(Version %in% "A", 100 - as.numeric(DV_Preference), as.numeric(DV_Preference))) %>%
  filter(!(ID=="33" & IV_Depth_Accept=="1"), !(ID=="51" & IV_Depth_Accept=="3"), !(ID=="106" & IV_Depth_Accept=="5")) %>% 
  arrange(ID)
  
  return(final)
}

#Comparing Subjective v Objective Danger Assessments (Exp. 3)

# retrieve AIC difference between two lowest AIC models
myAIC <- function(original, sample) {
  new_data <- original[sample,]

  boot_data1 <- cleaning1b.sub(new_data)
  boot_data2 <- cleaning3.sub(new_data)
  
  boot_data <- cbind(boot_data1, boot_data2)

  boot.sub.model3.adult <- lmer(data = boot_data, formula = DV_Preference ~ IV_Depth_Accept + (1|ID), na.action = na.exclude)
  AIC1 <- AIC(boot.sub.model3.adult)
  
  boot.sub.model3.fall.obj.adult <- lmer(data = boot_data, formula = DV_Preference ~ DV_Subj_Fall + IV_Depth_Accept + (1|ID), na.action = na.exclude)
  
  AIC2 <- AIC(boot.sub.model3.fall.obj.adult)
  
  return(AIC2-AIC1)               
} 

# bootstrap AIC function
boot.AIC.sub3.adult <- boot(data3.sub, statistic = myAIC, R = 1000) 
boot.AIC.sub3.adult

# confidence intervals
quantile(boot.AIC.sub3.adult$t, probs = c(0.025, 0.975)) 

#mean
mean(boot.AIC.sub3.adult$t)
```